<!DOCTYPE html>
<html lang="en" class="bgf">  
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no,minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta content="telephone=no" name="format-detection" />
    <!-- uc强制竖屏 -->
    <meta name="screen-orientation" content="portrait">
    <!-- UC应用模式 -->
    <meta name="browsermode" content="application">
    <!-- QQ强制竖屏 -->
    <meta name="x5-orientation" content="portrait">
    <!-- QQ应用模式 -->
    <meta name="x5-page-mode" content="app">
    <!-- UC禁止放大字体 -->
    <meta name="wap-font-scale" content="no">
    <title>校汇Plus | 校汇</title>
    <meta name="Keywords" content="校汇,广东农工商职业技术学院,AIB,农工商,能赚钱,大学生,大学生创业,大学生校园,大学生校园社团,大学生校园快递,大学生周边生活" />
    <meta name="Description" content="校汇是一个以校园任务为核心的移动互联网综合服务平台，立足于校园，致力打造完整的校园生态辐射圈。校汇一直专注于大学生活、社团文化、校园资讯、学生互动" />
    <link rel="apple-touch-icon-precomposed" href="./icon.png" />
    <link rel="shortcut icon" href="./icon.png" type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="../css/reset.css">
    <link rel="stylesheet" type="text/css" href="../css/index.css">
    <link href="../css/swiper.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="../css/info.css">
    <script src="http://libs.baidu.com/jquery/2.1.4/jquery.min.js"></script>
    <script type="text/javascript" src="../js/common.js"></script>
    <script src="../js/director.js"></script>
    <script type="text/javascript" src="../js/updata.js"></script>
    <script src="../js/swiper.min.js"></script>
    <script type="text/javascript" src="../js/upload.js"></script>
   

  </head>
  <body>

<div class="certification">
	<div class="header_title">
			<p>实名认证</p>
			<div class="return" onclick="returnUp()"></div>
	</div>
	<section id="write-list-input" class="pt1">
			<div id="beforeP">
			    <div id="post_img"></div>
                <input name="bookpic" type="file" id="bookpic" class="upload" onchange="change(this,1)">
			</div>
			<div id="afterP">
			    <div id="btnContainer"></div>
                <input name="bookpic" type="file" id="bookpic" class="upload" onchange="change(this,2)">

			</div>
            <div class="remark">
                <aside>注意</aside>
                <aside>照片中提供的身份证信息必须是真实有效且清晰可见<span>（以上示
例照片为保护模特隐私，不便显示相关信息）</span></aside>
                <p>1.手持证件人的五官和身份证正反面照片需清晰可见</p>
                <p>2.证件人手持身份证正反面的照片各一张</p>
                <p>3.点击上方照片框即可添加照片</p>
            </div>
            <div class="c_info">
                <input type="text" name="name" placeholder="姓名*" />
                <input type="text" name="card" placeholder="身份证号码*" />
            </div>
	</section>
	<div class="container">
			<button class="certification_submit opa_active">提交</button>
	</div>
</div>    
</body>
</html>
<script type="text/javascript"> 
		var dom,pic1="",pic2=""	;
        // locahost+'/user/realNameAuthUploadImg/?token='+token
            // 上传图片
  function change(that,num){
        fb_alert("开始上传");
        var field=new upField($(that));
        var maxSize=10240; //kb
         var name=$(that).attr('name');
        var pic = $(that).prop('files');
        var fordata=new FormData();
        fordata.append('uploadfile',pic[0]); //添加字段
       if(pic[0].size/1024>maxSize) { 
            fb_alert('图片不能超过'+maxSize+'kb')
            return false; 
       }
       var token = window.localStorage.token;
        $.ajax({
            url:locahost+'/user/realNameAuthUploadImg/?token='+token,
            type:'POST',
            dataType:'json',
            data:fordata,
            processData: false,
            contentType: false,
      error: function(){
        fb_alert('未知错误')
      },  
      success: function(data){
        if(data.code == 200){
            if(num == 1){
                //正面
                pic1 = data.url
            }else if(num == 2){
                //反面
                pic2 = data.url
                
            }
            $(that).prev().css("background-image","url("+data.url+")");

        }else{  
          fb_alert(data.detail);
        }
      }
        })

    };
	$(".certification_submit").on('click',certification_submit)
	function certification_submit(){
        var name = $('[name="name"]').val(),
        card = $('[name="card"]').val();
		if(pic1.length == 0 || pic2.length==0 ){
			fb_alert("请先上传身份证");
			return;
		}else if(name.length == 0){
            fb_alert("请填写你的姓名");
            return;
        }else if(card.length == 0){
            fb_alert("请填写你的身份证号码");
            return;
        }
        is_alipay(true);
	$.post(locahost+'/user/h5RealNameAuth/',{"token":token,"pic1":pic1,"pic2":pic2,"name":name,"id_number":card},  function(data){
           is_alipay(false);
           if(data.code == 2001){
                fb_alert(fb_error["2001"])
                window.location.href = "../login.html";
                return;
             }
             if(data.code == "200"){    
                 fb_alert(data.detail); 
                 var info = JSON.parse(window.localStorage.info);   
                 info.is_auth = 2; 
                 setItem("info",JSON.stringify(info));
                 history.go(-1)
             }else{
                 fb_alert(data.detail);    
              }
      }).error(function(xhr,errorText,errorType){
              alert('网络超时，请稍后再试')
    });

	}
 </script>